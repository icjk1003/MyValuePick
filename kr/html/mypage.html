<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>마이페이지 · MyValuePick</title>
  <link rel="stylesheet" href="../shared/css/common.css">
  <link rel="stylesheet" href="../shared/css/mypage.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" />
</head>
<body>

  <div id="global-header"></div>

  <main class="mypage-wrap">
    <div class="mypage-container">
      
      <aside class="mypage-sidebar card">
        <div class="profile-summary">
            <div class="profile-img-area">
                <label for="profileUpload" class="profile-upload-label">
                    <img src="" id="myProfileImg" alt="프로필">
                    <div class="profile-overlay">
                        <span>📷<br>사진 변경</span>
                    </div>
                </label>
                <input type="file" id="profileUpload" accept="image/*" class="file-input-hidden">
            </div>

          <h3 id="myNickDisplay">닉네임 로딩중</h3>
          <p id="myEmailDisplay" style="word-break: break-all; color: var(--muted); font-size: 13px;">user@email.com</p>
        </div>
        
        <nav class="mypage-menu">
          <a href="javascript:void(0)" onclick="showMypageSection('edit')" id="menu-edit" class="active">⚙️ 내 정보 관리</a>
          <a href="javascript:void(0)" onclick="showMypageSection('messages')" id="menu-messages"> 💌 쪽지함 <span id="msgBadge" class="menu-badge hidden">N</span></a>
          <a href="javascript:void(0)" onclick="showMypageSection('posts')" id="menu-posts">📝 내가 쓴 글</a>
          <a href="javascript:void(0)" onclick="showMypageSection('comments')" id="menu-comments">💬 내가 쓴 댓글</a>
          <a href="javascript:void(0)" onclick="showMypageSection('social')" id="menu-social">🔗 계정 연동</a>
          
          <div class="menu-sep"></div>
          <a href="#" onclick="logout()" class="menu-logout">로그아웃</a>
        </nav>
      </aside>

      <section id="section-edit" class="mypage-content card">
        <h2 class="section-title">내 정보 관리</h2>
        
        <div class="form-row">
          <label>이메일</label>
          <input type="email" id="myEmailInput" class="input-readonly" readonly>
          <p class="desc">이메일은 변경할 수 없습니다.</p>
        </div>

        <div class="form-row">
          <label>닉네임</label>
          <input type="text" id="myNickInput" class="input-edit" placeholder="닉네임을 입력하세요">
          <p id="nickCheckMsg" class="msg-mini"></p>
        </div>

        <div class="form-row">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
            <label style="margin-bottom:0;">자기소개</label>
            <div class="bio-btn-group">
              <button id="btnEditBio" class="btn-text-action">수정</button>
              <button id="btnSaveBio" class="btn-text-action primary hidden">저장</button>
              <button id="btnCancelBio" class="btn-text-action bad hidden">취소</button>
            </div>
          </div>
          <textarea id="myBioInput" class="input-bio input-readonly" readonly></textarea>
        </div>

        <div class="form-row">
          <label>비밀번호 변경</label>
          <input type="password" id="myPwInput" class="input-edit" placeholder="새 비밀번호 (변경시에만 입력)">
          <input type="password" id="myPwCheckInput" class="input-edit input-gap-top" placeholder="새 비밀번호 확인">
          <p id="pwCheckMsg" class="msg-mini"></p>
        </div>

        <div class="btn-area">
          <button id="btnSaveMyInfo" class="btn-save">변경사항 저장</button>
        </div>

        <div class="withdrawal-area">
          <span class="withdrawal-desc">더 이상 서비스를 이용하지 않으시려면</span>
          <button id="btnWithdrawal" class="btn-text-action bad">회원 탈퇴</button>
        </div>
      </section>

      <section id="section-messages" class="mypage-content card hidden">
        <h2 class="section-title">내 쪽지함</h2>
        
        <div class="msg-tabs">
            <button class="msg-tab-btn active" onclick="switchMsgTab('inbox')">받은 쪽지</button>
            <button class="msg-tab-btn" onclick="switchMsgTab('sent')">보낸 쪽지</button>
            <button class="msg-tab-btn" onclick="switchMsgTab('archive')">보관함</button>
            <button class="msg-tab-btn write-mode" onclick="switchMsgTab('write')">✍ 쪽지 쓰기</button>
        </div>

        <div id="msgListArea" class="msg-list-wrap">
            <table class="msg-table">
                <thead>
                    <tr>
                        <th width="15%">보낸사람</th>
                        <th>내용</th>
                        <th width="20%">날짜</th>
                        <th width="15%">관리</th>
                    </tr>
                </thead>
                <tbody id="msgListBody">
                    </tbody>
            </table>
            <div id="msgEmpty" class="empty-msg hidden">쪽지가 없습니다.</div>
        </div>

        <div id="msgViewArea" class="msg-view-wrap hidden">
            <div class="msg-view-header">
                <button class="btn-text-action" onclick="backToMsgList()">← 목록으로</button>
                <div class="msg-view-utils">
                    <button class="btn-small" id="btnMsgReply">답장</button>
                    <button class="btn-small btn-bad" id="btnMsgDelete">삭제</button>
                    <button class="btn-small" id="btnMsgArchive">보관</button>
                </div>
            </div>
            <div class="msg-view-content">
                <div class="msg-meta">
                    <span class="sender" id="viewSender">보낸사람</span>
                    <span class="date" id="viewDate">2024.01.01</span>
                </div>
                <div class="msg-body" id="viewBody">
                    내용...
                </div>
            </div>
        </div>

        <div id="msgWriteArea" class="msg-write-wrap hidden">
            <div class="form-row">
                <label>받는 사람 (닉네임)</label>
                <input type="text" id="msgReceiver" class="input-edit" placeholder="닉네임을 입력하세요">
            </div>
            <div class="form-row">
                <label>내용</label>
                <textarea id="msgContent" class="input-bio" placeholder="내용을 입력하세요 (500자 이내)"></textarea>
            </div>
            <div class="btn-area">
                <button class="btn-text-action bad" onclick="switchMsgTab('inbox')">취소</button>
                <button class="btn-save" onclick="sendDirectMessage()">보내기</button>
            </div>
        </div>
      </section>

      <section id="section-posts" class="mypage-content card hidden">
        <h2 class="section-title">내가 쓴 글</h2>
        <div id="myPostsList" class="my-content-list"></div>
      </section>

      <section id="section-comments" class="mypage-content card hidden">
        <h2 class="section-title">내가 쓴 댓글</h2>
        <div id="myCommentsList" class="my-content-list"></div>
      </section>

      <section id="section-social" class="mypage-content card hidden">
        <h2 class="section-title">계정 연동 관리</h2>
        <p class="desc" style="margin-bottom: 30px;">
            자주 사용하는 소셜 계정을 연동하여 간편하게 로그인할 수 있습니다.<br>
            연동을 해제하면 해당 계정으로는 더 이상 로그인할 수 없습니다.
        </p>
        
        <div class="social-link-list">
            
            <div class="social-item">
                <div class="social-info">
                    <div class="social-icon google">
                        <svg width="20" height="20" viewBox="0 0 24 24">
                            <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                            <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                            <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.21.81-.63z" fill="#FBBC05"/>
                            <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                        </svg>
                    </div>
                    <div class="social-text">
                        <div class="name">Google</div>
                        <div class="status" id="status-google">연동 안됨</div>
                    </div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="toggle-google" onchange="toggleSocial('google')">
                    <span class="slider"></span>
                </label>
            </div>

            <div class="social-item">
                <div class="social-info">
                    <div class="social-icon naver">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M16.273 12.845L7.376 0H0v24h7.726V11.156l8.897 12.844h7.377V0h-7.727v12.845z"/>
                        </svg>
                    </div>
                    <div class="social-text">
                        <div class="name">Naver</div>
                        <div class="status" id="status-naver">연동 안됨</div>
                    </div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="toggle-naver" onchange="toggleSocial('naver')">
                    <span class="slider"></span>
                </label>
            </div>

            <div class="social-item">
                <div class="social-info">
                    <div class="social-icon kakao">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 3C5.373 3 0 6.666 0 11.19c0 2.873 2.16 5.426 5.438 6.905-.246.905-.886 3.287-.91 3.427 0 0-.018.16.082.22.1.062.222.036.222.036.002 0 3.328-2.28 3.86-2.628.988.14 2.012.215 3.064.215 6.627 0 12-3.666 12-8.19C24 6.666 18.627 3 12 3z"/>
                        </svg>
                    </div>
                    <div class="social-text">
                        <div class="name">Kakao</div>
                        <div class="status" id="status-kakao">연동 안됨</div>
                    </div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="toggle-kakao" onchange="toggleSocial('kakao')">
                    <span class="slider"></span>
                </label>
            </div>

            <div class="social-item">
                <div class="social-info">
                    <div class="social-icon apple">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M17.05 20.28c-.98.95-2.05.88-3.08.4-1.09-.5-2.08-.48-3.24.02-1.44.62-2.2.44-3.06-.4C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.74 1.18 0 2.45-1.04 4.09-.76 1.77.3 2.94 1.25 3.48 2.56-3.08 1.48-2.68 5.76.51 7.05-.62 1.64-1.55 3.25-3.16 3.38zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.54 4.39-3.74 4.25z"/>
                        </svg>
                    </div>
                    <div class="social-text">
                        <div class="name">Apple</div>
                        <div class="status" id="status-apple">연동 안됨</div>
                    </div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="toggle-apple" onchange="toggleSocial('apple')">
                    <span class="slider"></span>
                </label>
            </div>

        </div>
      </section>

    </div>
  </main>

  <div id="cropModal" class="modal-overlay hidden">
    <div class="crop-container">
      <h3>프로필 사진 자르기</h3>
      <div class="crop-area">
        <img id="imageToCrop" src="" alt="자르기 할 이미지">
      </div>
      <div class="crop-btns">
        <button id="btnCropCancel" class="btn-text-action bad">취소</button>
        <button id="btnCropConfirm" class="btn primary">적용하기</button>
      </div>
    </div>
  </div>

  <div id="global-footer"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
  <script src="../shared/js/common.js"></script>
  <script src="../shared/js/mypage.js"></script>
</body>
</html>